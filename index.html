html = r"""<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ü¶∑DentBlog | ÏπòÏùòÌïô ÌïôÏäµ ÌîåÎû´Ìèº</title>
  <meta name="description" content="ÏπòÏùòÌïô ÏòÅÏÉÅ¬∑ÏùºÎ∞ò ÌïôÏäµÏùÑ ÏúÑÌïú ÌîåÎûòÏãúÏπ¥Îìú ¬∑ ÌÄ¥Ï¶à ¬∑ ÏπºÎüº" />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <style>
    :root{
      --bg:#fafafc; --panel:#ffffff; --panel-2:#f3f5f8; --text:#0f172a; --muted:#55627a; --line:#e4e8ef;
      --brand:#111827; --brand-2:#1f2937; --ok:#16a34a; --bad:#dc2626; --warn:#f59e0b;
      --radius:14px; --shadow:0 10px 30px rgba(15,23,42,.08); --maxw:1120px;
      --fs-hero: clamp(24px, 2.4vw, 36px);
      --fs-h1: clamp(20px, 2vw, 28px);
      --fs-h2: clamp(18px, 1.7vw, 24px);
      --fs-h3: clamp(16px, 1.5vw, 20px);
      --fs-body: clamp(14px, 1.2vw, 16px);
      --fs-small: clamp(12px, 1vw, 14px);
    }
    html.dark{
      --bg:#0f172a; --panel:#111827; --panel-2:#1f2937; --text:#e5e7eb; --muted:#94a3b8; --line:#374151;
      --brand:#e5e7eb; --brand-2:#cbd5e1; --ok:#4ade80; --bad:#f87171; --warn:#facc15;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:500 var(--fs-body)/1.65 "Pretendard","Inter","Segoe UI",system-ui,-apple-system,sans-serif;
      background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
      transition:background-color .25s, color .25s;
    }
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}
    button{cursor:pointer; font-family:inherit}

    header{position:sticky;top:0;z-index:50;background:color-mix(in oklab, var(--panel) 88%, transparent);backdrop-filter:saturate(140%) blur(10px);border-bottom:1px solid var(--line)}
    .nav{max-width:var(--maxw);margin:0 auto;display:flex;align-items:center;gap:12px;padding:12px 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900; letter-spacing:.1px; color:var(--brand)}
    .brand .logo{font-size:22px; line-height:1}
    .tabs{margin-left:auto;display:flex;gap:6px}
    .tab{padding:10px 14px;border-radius:10px;background:var(--panel); color:var(--muted); font-weight:700; box-shadow:0 1px 0 var(--line) inset; transition:all .15s}
    .tab.active{background:linear-gradient(180deg,#eef2ff,#e0e7ff); color:#111827}
    html.dark .tab.active{background:var(--panel-2); color:var(--text)}
    .theme{margin-left:6px;border:none;border-radius:12px;padding:10px 12px;background:var(--panel); box-shadow:0 1px 0 var(--line) inset; color:var(--muted)}

    main{max-width:var(--maxw);margin:0 auto;padding:18px}
    section.view{display:none}
    section.view.active{display:block}

    .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);padding:14px; transition:background-color .2s, border-color .2s}
    .shadow{box-shadow:var(--shadow)}
    .muted{color:var(--muted)}

    .btn{border:none;background:linear-gradient(180deg,#ffffff,#f8fafc);color:#0b1020;border-radius:12px;padding:10px 14px; font-weight:800; box-shadow:0 1px 0 rgba(0,0,0,.04) inset; transition:transform .08s ease;}
    .btn:active{transform:translateY(1px)}
    html.dark .btn{background:var(--panel); color:var(--text)}
    .btn.primary{background:linear-gradient(180deg,#222,#111); color:#fff}
    .btn.ok{background:linear-gradient(180deg,#34d399,#16a34a);color:#fff}
    .btn.bad{background:linear-gradient(180deg,#fca5a5,#ef4444);color:#fff}
    .btn.small{padding:8px 10px; border-radius:10px; font-weight:700}
    .btn.round{border-radius:999px; padding:8px 10px}
    .btn.icon{width:36px;height:36px;padding:0;display:grid;place-items:center;border-radius:12px;font-size:16px}

    .btn-nav{border:none;background:var(--panel);color:var(--text);border-radius:12px;padding:10px 12px;display:inline-flex;align-items:center;gap:6px;font-weight:800;box-shadow:0 1px 0 var(--line) inset;transition:transform .08s}
    .btn-nav:active{transform:translateY(1px)}

    .chips{display:flex;gap:6px;flex-wrap:wrap}
    .chip{display:inline-flex;align-items:center;padding:4px 10px;border-radius:999px;border:1px solid var(--line);background:#eef2ff;color:#1e3a8a;font-size:12px}
    html.dark .chip{background:var(--panel-2); color:var(--text)}
    .grid{display:grid;gap:12px}
    .hero{display:grid;gap:8px;margin:6px 0 14px;text-align:center;padding: 16px 0;}
    .hero h1{margin:0;font-size:var(--fs-hero); font-weight:900}
    .hero p{margin:0 auto; max-width:780px; font-size: clamp(15px, 1.3vw, 18px)}
    .stat{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:12px;background:var(--panel);border:1px solid var(--line); font-weight:800}

    .typing{display:inline-block; overflow:hidden; white-space:nowrap; border-right:2px solid var(--brand); animation:typing 4s steps(40,end) 1, caret 1s step-end infinite;}
    @keyframes typing{ from{width:0} to{width:100%} }
    @keyframes caret{ 50%{border-color:transparent} }

    .set-tile{display:flex;gap:14px; cursor:pointer; padding:12px; border:1px solid var(--line); border-radius:12px; background:var(--panel)}
    .set-tile:hover{background:var(--panel-2)}
    .thumb{width:112px;height:84px;border-radius:10px;border:1px dashed var(--line);overflow:hidden;background:var(--panel-2);display:grid;place-items:center; color:var(--muted); font-size:12px}
    .thumb:before{content:'ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÜÏùå';}
    .tile-body{flex:1;display:grid;gap:6px}

    .progress{height:10px;background:#e5e7eb;border:1px solid #d1d5db;border-radius:999px;overflow:hidden}
    html.dark .progress{background:var(--panel-2);border-color:var(--line)}
    .progress>i{display:block;height:100%;background:#111827}

    .flash-frame{display:grid; grid-template-columns:1fr 1fr; gap:16px; box-shadow:var(--shadow)}
    @media (max-width:900px){ .flash-frame{grid-template-columns:1fr} }
    .flash-visual{display:flex; justify-content:center; align-items:center; padding:16px}
    .flash-visual img{max-height:420px; width:100%; height:auto; object-fit:contain}

    .flash-card{position:relative; padding:12px; cursor:pointer}
    .flash-card .front,.flash-card .back{display:none;flex-direction:column; align-items:center; justify-content:center;gap:10px; padding:16px; border-radius:12px; border:1px solid var(--line);background:var(--panel); text-align:center;white-space:normal; word-wrap:break-word; line-height:1.5;}
    .flash-card .back{ background:var(--panel-2) }
    .flash-card.show-front .front{ display:flex }
    .flash-card.show-back  .back{ display:flex }

    .hint{ font-size:12px; color:var(--muted) }
    .countdown{position:absolute; inset:0; display:grid; place-items:center;background:rgba(0,0,0,.55); color:#fff; font-size:48px; font-weight:900;border-radius:12px; opacity:0; transition:opacity .2s;pointer-events:none; z-index:2;}
    .countdown.show{ opacity:1; pointer-events:auto }

    .bin{ text-align:center }
    .bin-bar{height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden;}
    .bin-bar i{height:100%;display:block;background:#111827; transition:width .2s ease-in-out;}

    .opt{border:1px solid var(--line);border-radius:10px;padding:12px;background:var(--panel); transition:all .2s}
    .opt:hover{border-color:#111827;background:var(--panel-2)}
    .opt.correct{border-color:var(--ok);background:color-mix(in oklab, var(--ok) 18%, transparent)}
    .opt.wrong{border-color:var(--bad);background:color-mix(in oklab, var(--bad) 18%, transparent)}

    .blog{display:grid;grid-template-columns:320px 1fr;gap:16px; min-height:600px}
    @media (max-width:980px){.blog{grid-template-columns:1fr}}
    .blog-sidebar{position:sticky; top:84px; align-self:flex-start; max-height:calc(100vh - 120px); overflow-y:auto; padding:0;}
    .blog-list{list-style:none;padding:0;margin:0}
    .blog-list a{display:block;padding:10px 12px;border-radius:10px;color:var(--muted);border:1px solid transparent}
    .blog-list a:hover{background:var(--panel-2); color:var(--text)}
    .blog-list a.active{background:#111827; color:#fff; font-weight:800; border-color:transparent}
    .blog-view{padding:18px;min-height:160px; background:var(--panel); border-radius:12px; box-shadow:var(--shadow)}
    .blog-view h1{font-size:var(--fs-h1);margin:.2em 0 .5em; border-bottom:1px solid var(--line); padding-bottom:8px}
    .blog-view h2{font-size:var(--fs-h2);margin:1.3em 0 .4em; border-bottom:none; padding-bottom:0}
    .blog-view h3{font-size:var(--fs-h3);margin:1em 0 .4em}
    .editor input,.editor textarea{width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:var(--panel);color:var(--text)}
    .editor textarea{min-height:180px;margin-bottom:8px}
    .toc{margin-top:12px;font-size:var(--fs-small)}
    .toc ul{list-style:none;margin:0;padding-left:0}
    .toc li{margin:6px 0 0 0;padding-left:12px;border-left:1px dashed var(--line)}
    .toc a{color:var(--muted)}
    .toc a:hover{color:var(--text)}

    .toast{position:fixed;inset:auto 16px 16px auto;background:#111827;color:#e5e7eb;border:1px solid #374151;padding:10px 12px;border-radius:10px;box-shadow:var(--shadow);opacity:0;transform:translateY(8px);transition:all .25s}
    .toast.show{opacity:1;transform:translateY(0)}
    #loader{position:fixed; inset:0; display:none; place-items:center; background:color-mix(in oklab, var(--bg) 70%, transparent); z-index:100}
    #loader.show{display:grid}
    .spinner{width:42px;height:42px;border-radius:50%;border:4px solid #cbd5e1;border-top-color:#111827; animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    footer{margin:24px 0;color:var(--muted); text-align:center}

    .filters{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .filters .label{font-weight:800; color:var(--muted); font-size:12px}
    .select{position:relative; display:inline-flex; align-items:center; gap:8px; background:var(--panel); border:1px solid var(--line); border-radius:12px; padding:6px 10px}
    .select select{border:none; outline:none; background:transparent; padding:6px; min-width:160px; color:var(--text)}
    .select:after{content:'‚åµ'; color:var(--muted);}
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="brand" data-nav="home" role="button" aria-label="ÌôàÏúºÎ°ú Ïù¥Îèô">
        <div class="logo">ü¶∑</div><div>DentBlog</div>
      </div>
      <div class="tabs" role="tablist">
        <a class="tab" data-nav="home" role="tab" aria-selected="true">Ìôà</a>
        <a class="tab" data-nav="sets" role="tab">ÏÑ∏Ìä∏</a>
        <a class="tab" data-nav="blog" role="tab">ÏπºÎüº</a>
      </div>
      <button id="theme-btn" class="theme" data-action="toggle-theme" aria-label="ÌÖåÎßà Ï†ÑÌôò">‚óê</button>
    </div>
  </header>

  <main>
    <section id="view-home" class="view active home">
      <div class="hero">
        <h1>ü¶∑DentBlog</h1>
        <p class="typing">ÌîåÎûòÏãúÏπ¥Îìú¬∑ÌÄ¥Ï¶à¬∑ÏπºÎüºÏúºÎ°ú ÏπòÏùòÌïôÏùÑ ÏâΩÍ≤å ÌïôÏäµÌïòÏÑ∏Ïöî.</p>
        <div id="home-stats" class="chips" style="justify-content:center; gap:8px"></div>
      </div>

      <div class="card shadow" style="padding:0; overflow:hidden; margin-bottom:12px">
        <div style="display:flex; overflow:auto; gap:12px; padding:12px;">
          <img src="https://via.placeholder.com/1100x120/222222/ffffff?text=BANNER+1" alt="Î∞∞ÎÑà" style="width:100%; min-width:320px; height:120px; object-fit:cover; border-radius:8px;"/>
          <img src="https://via.placeholder.com/1100x120/111111/ffffff?text=BANNER+2" alt="Î∞∞ÎÑà" style="width:100%; min-width:320px; height:120px; object-fit:cover; border-radius:8px;"/>
        </div>
      </div>

      <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
        <div class="card shadow">
          <div class="muted" style="font-weight:800;margin-bottom:8px">Ï∂îÏ≤ú ÏÑ∏Ìä∏</div>
          <div id="home-reco" class="grid" style="grid-template-columns:repeat(auto-fill,minmax(320px,1fr));"></div>
        </div>
        <div class="card shadow">
          <div class="muted" style="font-weight:800;margin-bottom:8px">ÏπºÎüº ÏµúÏã†</div>
          <div id="home-blog-list" class="grid" style="grid-template-columns:1fr; gap:8px;"></div>
        </div>
      </div>

      <footer>¬© 2025 DentBlog ¬∑ made by DO</footer>
    </section>

    <section id="view-sets" class="view sets">
      <div class="hero" style="text-align:left">
        <h1 style="font-size:var(--fs-h1)">ÌïôÏäµ ÏÑ∏Ìä∏</h1>
        <p class="muted">Flash/QuizÎ°ú Í≥µÎ∂ÄÌïòÏÑ∏Ïöî.</p>
      </div>
      <div class="card shadow" style="margin-bottom:12px">
        <div class="filters">
          <input id="q" placeholder="Í≤ÄÏÉâ" style="flex:1;padding:12px;border-radius:12px;border:1px solid var(--line);background:#fff;color:#0f172a"/>
          <div class="select">
            <span class="label">Íµ¨Î∂Ñ</span>
            <select id="mod">
              <option value="">Ï†ÑÏ≤¥</option>
            </select>
          </div>
        </div>
      </div>
      <div id="set-list" class="grid" style="grid-template-columns:repeat(auto-fill, minmax(320px, 1fr));"></div>
    </section>

    <section id="view-flash" class="view">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px">
        <button class="btn-nav" data-nav="sets">‚Üê ÏÑ∏Ìä∏</button>
        <div style="flex:1;">
          <h2 id="flash-title" style="margin:0; font-size:var(--fs-h1)"></h2>
        </div>
        <div style="display:flex;gap:8px;">
          <button class="btn-nav" data-action="flash-prev">Ïù¥Ï†Ñ(‚Üê)</button>
          <button class="btn-nav" data-action="flash-next">Îã§Ïùå(‚Üí)</button>
        </div>
      </div>

      <div class="progress"><i id="flash-bar" style="width:0%"></i></div>

      <div id="flash-frame" class="card shadow flash-frame" style="margin-top:12px">
        <div class="flash-visual">
          <img id="flash-img" alt="x-ray"/>
        </div>

        <div class="flash-card" id="flash-card" data-action="flash-toggle" aria-label="Ïπ¥ÎìúÎ•º ÌÅ¥Î¶≠ÌïòÎ©¥ Ï†ïÎãµÏùÑ Î≥º Ïàò ÏûàÏäµÎãàÎã§">
          <div class="front" id="flash-front">
            <div style="font-weight:900; font-size:var(--fs-h2); display:flex; align-items:center; justify-content:center; text-align:center">
              <span id="flash-question">Ïù¥ ÏòÅÏÉÅÏùò ÏßÑÎã®Î™ÖÏùÄ?</span>
            </div>
            <div class="hint">Ïπ¥ÎìúÎ•º ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò Ïä§ÌéòÏù¥Ïä§Î∞îÎ•º ÎàåÎü¨ Ï†ïÎãµÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî</div>
          </div>
          <div class="back" id="flash-back">
            <div>
              <div class="muted">Ï†ïÎãµ</div>
              <div id="flash-answer" style="font-size:var(--fs-h2);font-weight:900;margin:4px 0 8px"></div>
              <div id="flash-explain" class="muted" style="max-width:520px;margin:0 auto"></div>
            </div>
          </div>
          <div id="countdown" class="countdown" aria-hidden="true"></div>
        </div>

        <div class="card">
          <div class="muted" style="font-weight:800;margin-bottom:8px">Ï±ÑÏ†ê</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn ok"  data-action="flash-grade" data-ok="1">ÏïåÏïòÎã§</button>
            <button class="btn bad" data-action="flash-grade" data-ok="0">Î™∞ÎûêÎã§</button>
          </div>
          <div id="bins" style="display:grid; grid-template-columns:repeat(5,1fr); gap:12px; margin-top: 12px;"></div>
        </div>

        <div class="card">
          <div class="muted" style="font-weight:800;margin-bottom:8px">ÌÉêÏÉâ¬∑ÌÉÄÏù¥Î®∏</div>
          <div style="display:flex;gap:10px;align-items:center; flex-wrap:wrap">
            <span id="flash-pos" class="stat">0/0</span>
            <label>ÌÉÄÏù¥Î®∏
              <select id="timer-select" style="padding:10px;border-radius:12px;border:1px solid var(--line);background:var(--panel);min-width:100px">
                <option value="3">3Ï¥à</option>
                <option value="5" selected>5Ï¥à</option>
                <option value="10">10Ï¥à</option>
              </select>
            </label>
            <button class="btn primary" data-action="start-timer" id="timer-btn">ÌÉÄÏù¥Î®∏ ÏãúÏûë</button>

            <label style="display:inline-flex;gap:6px;align-items:center;margin-left:8px">
              <input type="checkbox" id="auto-next" checked />
              Ï†ïÎãµ ÌõÑ ÏûêÎèô ÎÑòÍπÄ
            </label>
            <label>
              ÏßÄÏó∞
              <select id="auto-next-delay" style="padding:10px;border-radius:12px;border:1px solid var(--line);background:var(--panel);min-width:90px">
                <option value="3000">3Ï¥à</option>
                <option value="5000" selected>5Ï¥à</option>
                <option value="7000">7Ï¥à</option>
                <option value="10000">10Ï¥à</option>
              </select>
            </label>

            <button class="btn round" data-action="flash-autoplay" id="autoplay-btn" aria-label="Ïó∞ÏÜç ÏûêÎèô ÌïôÏäµ ÌÜ†Í∏Ä">‚ñ∏</button>
          </div>
        </div>
      </div>
    </section>

    <section id="view-quiz" class="view">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
        <button class="btn-nav" data-nav="sets">‚Üê ÏÑ∏Ìä∏</button>
        <h2 id="quiz-title" style="margin:0; font-size:var(--fs-h1)"></h2>
      </div>
      <div class="card shadow" style="margin-bottom:10px">
        <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
          <label>Î™®Îìú
            <select id="quiz-mode" style="padding:10px;border-radius:12px;border:1px solid var(--line);background:#fff;color:#0f172a">
              <option value="mc">Í∞ùÍ¥ÄÏãù</option>
              <option value="tf">OX</option>
              <option value="fill">ÎπàÏπ∏</option>
            </select>
          </label>
          <label>Î¨∏Ìï≠ Ïàò
            <select id="quiz-n" style="padding:10px;border-radius:12px;border:1px solid var(--line);background:#fff;color:#0f172a">
              <option>5</option><option selected>10</option><option>15</option>
            </select>
          </label>
          <button class="btn primary" data-action="quiz-start">ÏãúÏûë</button>
        </div>
      </div>
      <div class="card shadow" id="quiz-stage" style="display:none"></div>
    </section>

    <section id="view-blog" class="view">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
        <h1 style="margin:0;font-size:var(--fs-h1)">ÏπºÎüº</h1>
        <div style="margin-left:auto;display:flex;gap:8px;align-items:center;">
          <input id="blog-q" placeholder="Í≤ÄÏÉâ" style="padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:var(--panel);color:var(--text)"/>
          <button class="btn" data-action="blog-new">ÏÉà Í∏Ä</button>
        </div>
      </div>
      <p class="muted" style="margin-top:0;">ÏπòÏùòÌïô Ïù¥Î°†ÏùÑ Í≥µÎ∂ÄÌï¥Ïöî.</p>

      <div class="blog">
        <aside class="blog-sidebar">
          <div class="card" style="padding:12px; position:sticky; top:0;">
            <div style="display:flex;align-items:center;justify-content:space-between;gap:8px; padding-bottom:8px; border-bottom:1px solid var(--line)">
              <div style="font-weight:900; font-size:1.05em;">Í∏Ä Î™©Î°ù</div>
              <button class="btn small" data-action="blog-list-toggle" title="Ï†ëÍ∏∞/ÌéºÏπòÍ∏∞">&gt;</button>
            </div>
            <ul id="blog-list" class="blog-list" style="margin-top:8px"></ul>
            <div id="blog-toc" class="toc" style="display:none;"></div>
          </div>
        </aside>
        <div>
          <div id="blog-view" class="blog-view"></div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:8px">
            <input id="blog-key" type="password" placeholder="Í¥ÄÎ¶¨Ïûê ÌÇ§(0917)" style="padding:10px;border-radius:12px;border:1px solid var(--line)" />
            <button class="btn" data-action="blog-edit">ÏàòÏ†ï</button>
            <button class="btn bad" data-action="blog-delete">ÏÇ≠Ï†ú</button>
            <button class="btn icon" data-action="tts-body" aria-label="Î≥∏Î¨∏ ÏùΩÍ∏∞/ÏùºÏãúÏ†ïÏßÄ">‚ñ∏</button>
            <button class="btn icon" data-action="tts-stop" aria-label="Ï†ïÏßÄ">‚ñ†</button>
          </div>
          <div id="blog-editor" class="editor" style="display:none;margin-top:10px">
            <input id="blog-title" placeholder="Ï†úÎ™©" />
            <textarea id="blog-body" placeholder="ÎÇ¥Ïö©(Markdown ÏßÄÏõê)"></textarea>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="btn primary" data-action="blog-save">Ï†ÄÏû•</button>
              <button class="btn" data-action="blog-cancel">Ï∑®ÏÜå</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="view-admin" class="view">
      <div class="hero" style="text-align:left">
        <h1 style="font-size:var(--fs-h1)">Í¥ÄÎ¶¨Ïûê</h1>
        <p class="muted">Í¥ÄÎ¶¨Ïûê ÌÇ§Îäî Í≥†Ï†ïÎêòÏñ¥ ÏûàÏäµÎãàÎã§. Ï†ÄÏû• Í∏∞Îä•ÏùÄ ÏóÜÏäµÎãàÎã§.</p>
      </div>
      <div class="grid cols-2">
        <div class="card shadow">
          <h3 style="margin-top:0; font-size:var(--fs-h2)">Ïπ¥Îìú ÏùºÍ¥Ñ Îì±Î°ù</h3>
          <div style="display:grid;gap:8px">
            <input id="adm-key" type="password" placeholder="Í¥ÄÎ¶¨Ïûê ÌÇ§(0917)"/>
            <select id="adm-target" style="padding:10px;border-radius:12px;border:1px solid var(--line);background:#fff;color:#0f172a"></select>
            <input id="adm-newset" placeholder="ÏÉà ÏÑ∏Ìä∏ Ïù¥Î¶Ñ(Ïã†Í∑ú ÏÉùÏÑ± Ïãú)"/>
            <textarea id="adm-json" placeholder='[{"q":"Î¨∏Ï†ú","a":"Ï†ïÎãµ","e":"Ìï¥ÏÑ§","img":"url","tags":"CBCT;ÎÇ≠Ï¢Ö"}]' rows="6"></textarea>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <input id="adm-file" type="file" accept=".csv,.xlsx,.json"/>
              <button class="btn" data-action="adm-json">JSON Îì±Î°ù</button>
              <button class="btn" data-action="adm-file">ÌååÏùº Îì±Î°ù(CSV/XLSX/JSON)</button>
              <button class="btn bad" data-action="adm-reset">Î™®Îì† Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî</button>
            </div>
          </div>
        </div>

        <div class="card shadow">
          <h3 style="margin-top:0; font-size:var(--fs-h2)">ÏõêÍ≤© Îç∞Ïù¥ÌÑ∞</h3>
          <div class="muted" style="margin-bottom:6px">GitHub Pages ÏõêÍ≤© Îç∞Ïù¥ÌÑ∞ ÏûêÎèô ÌÉêÏÉâ/Ï†ÅÏö©</div>
          <div class="chips" style="margin-bottom:8px">
            <span class="chip">data/sets.(json|csv|xlsx)</span>
            <span class="chip">data/blogs.(json|csv|xlsx)</span>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
            <button class="btn" data-action="remote-reload">ÏõêÍ≤© Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®</button>
          </div>
          <pre id="dev-log" class="muted" style="white-space:pre-wrap;background:var(--panel-2);border:1px solid var(--line);padding:10px;border-radius:10px;max-height:260px;overflow:auto"></pre>
        </div>

        <div class="card shadow" style="grid-column:1/-1">
          <h3 style="margin-top:0; font-size:var(--fs-h2)">CSV/XLSX Ïª¨Îüº Í∞ÄÏù¥Îìú</h3>
          <div class="muted">Ìó§Îçî Í∂åÏû•. ÏßÄÏõê Ïª¨Îüº: <b>q, a, e, img, tags, set, modality, set_desc, group</b> (tagsÎäî ÏÑ∏ÎØ∏ÏΩúÎ°†; Íµ¨Î∂Ñ) ‚Äî ÏÑ∏Ìä∏ Î¨∂ÏùåÏùÄ <b>group</b> ÏÇ¨Ïö©.</div>
<pre class="muted" style="white-space:pre-wrap;background:var(--panel-2);border:1px solid var(--line);padding:10px;border-radius:10px">q,a,e,img,tags,set,modality,set_desc,group
Ïù¥ ÏòÅÏÉÅÏùò ÏßÑÎã®Î™ÖÏùÄ?,Dentigerous cyst,Îß§Î≥µÏπò ÏπòÍ¥Ä Ï£ºÏúÑ Î∞©ÏÇ¨ÏÑ†Ìà¨Í≥º,https://ex.com/dentigerous.jpg,Panorama;ÎÇ≠Ï¢Ö,ÎÇ≠Ï¢Ö vs Ï¢ÖÏñë Í∞êÎ≥Ñ,Panorama,Í≤ΩÍ≥Ñ¬∑ÌîºÏßàÌôî¬∑ÏπòÍ∑º Ìù°Ïàò¬∑Îß§Î≥µÏπò Í¥ÄÍ≥Ñ,ÏòÅÏÉÅÍ∞êÎ≥Ñ(Í∏∞Î≥∏)
ÏûÑÌîåÎûÄÌä∏ Ï£ºÏúÑ Î∞©ÏÇ¨ÏÑ†Ìà¨Í≥º ÏÜåÍ≤¨?,Peri-implantitis,ÌÅ¨Î†àÏù¥ÌÑ∞Ìòï Í≤∞ÏÜê,https://ex.com/implantitis.jpg,Periapical;ÏûÑÌîåÎûÄÌä∏,ÏπòÏ£º/ÏûÑÌîåÎûÄÌä∏ ÏòÅÏÉÅ,Periapical,Ìï©Î≥ëÏ¶ù ÏúÑÏ£º Ï≤¥ÌÅ¨,ÏûÑÌîåÎûÄÌä∏</pre>
        </div>
      </div>
    </section>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>
  <div id="loader" aria-hidden="true"><div class="spinner" aria-label="Î°úÎî©Ï§ë"></div></div>

  <script>
    const baseUrl = 'https://raw.githubusercontent.com/nihicheli/dentblog/main/';
    const RemotePaths = { sets:  ['data/sets.json','data/sets.csv','data/sets.xlsx'], blogs: ['data/blogs.json','data/blogs.csv','data/blogs.xlsx'] };
    const ADMIN_KEY='0917';

    const $$ = (sel,root=document)=>Array.from(root.querySelectorAll(sel));
    const $ = (sel,root=document)=>root.querySelector(sel);
    const note=(msg, warn)=>{ const t=$('#toast'); if(!t) return; t.textContent=msg; t.style.background= warn? '#991b1b':'#111827'; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 1400); };
    const busy=(on,msg)=>{ const l=$('#loader'); if(!l) return; if(on){ l.classList.add('show'); if(msg) note(msg); } else { l.classList.remove('show'); } };
    const uid=()=>Math.random().toString(36).slice(2,9);
    const slug=s=>(s||'').trim().toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'')||('id-'+uid());
    const esc=s=>(s==null?'':String(s)).replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));
    const mdDate=t=>{ const d=new Date(t); const mm=('0'+(d.getMonth()+1)).slice(-2), dd=('0'+d.getDate()).slice(-2); return `${mm}/${dd}` };
    const norm=s=>(s||'').toString().trim().toLowerCase().replace(/\s+/g,' ');
    const sample=(a,n)=>{const x=[...a]; const out=[]; while(x.length&&out.length<n){ out.push(x.splice((Math.random()*x.length)|0,1)[0]) } return out };
    const shuffle=a=>{for(let i=a.length-1;i>0;i++){const j=(Math.random()*(i+1)|0);[a[i],a[j]]=[a[j]]}return a};
    const parseTags=t=>!t?[]:Array.isArray(t)?t:String(t).split(/;|,/).map(s=>s.trim()).filter(Boolean);
    const splitCSV=line=>{ const res=[]; let cur=''; let q=false; for(let i=0;i<line.length;i++){ const ch=line[i]; if(ch==='"'){ if(q && line[i+1]==='"'){ cur+='"'; i++; } else { q=!q; } } else if(ch===',' && !q){ res.push(cur); cur=''; } else { cur+=ch; } } res.push(cur); return res.map(s=>s.trim()); };
    const parseCSV=txt=>{ if(!txt) return []; const lines = txt.split(/\r?\n/).filter(l=>l.trim()); if(!lines.length) return []; const head = splitCSV(lines[0]); const out=[]; for(let i=1;i<lines.length;i++){ const cols = splitCSV(lines[i]); const row={}; head.forEach((h,idx)=> row[h]=cols[idx]); out.push(row); } return out; };
    const ph=label=>{ const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='720' height='420'><defs><linearGradient id='g' x1='0' x2='1'><stop offset='0' stop-color='#e5e7eb'/><stop offset='1' stop-color='#cbd5e1'/></linearGradient></defs><rect width='100%' height='100%' fill='url(#g)'/><g fill='#1f2937' font-family='Arial' text-anchor='middle'><text x='50%' y='50%' font-size='22' font-weight='700'>${esc(label)}</text><text x='50%' y='58%' font-size='12' fill='#6b7280'>Demo Placeholder</text></g></svg>`; return 'data:image/svg+xml;utf8,'+encodeURIComponent(svg); };

    const tts = { synth: window.speechSynthesis, state: 'idle', speak(text){ try{ if(!text||!this.synth) return; if(this.synth.speaking){ this.synth.cancel(); } const u=new SpeechSynthesisUtterance(text); u.lang='ko-KR'; u.onend=()=>{ this.state='idle'; updateTTSLabels(); }; this.synth.speak(u); this.state='speaking'; updateTTSLabels(); }catch(e){} }, toggle(text){ if(this.state==='speaking'){ this.pause(); return; } if(this.state==='paused'){ this.resume(); return; } this.speak(text); }, pause(){ try{ this.synth.pause(); this.state='paused'; updateTTSLabels(); }catch(e){} }, resume(){ try{ this.synth.resume(); this.state='speaking'; updateTTSLabels(); }catch(e){} }, stop(){ try{ this.synth.cancel(); this.state='idle'; updateTTSLabels(); }catch(e){} } };
    function updateTTSLabels(){ $$('.btn.icon[data-action="tts-body"]').forEach(b=>{ b.textContent = (tts.state==='speaking')? '‚à•' : (tts.state==='paused'? '‚ñ∏' : '‚ñ∏'); }); $$('.btn.icon[data-action="tts-stop"]').forEach(b=> b.textContent='‚ñ†'); }

    const markdown=(src='')=>{ let s=esc(src); const heads=[]; s = s.replace(/^(#{1,4})\s+(.+)$/gm,(_,h,ct)=>{ const id = slug(ct); heads.push({id, level:h.length, text:ct}); return `<h${h.length} id="${id}">${ct}</h${h.length}>`; }); s=s.replace(/```([\s\S]*?)```/g,(m,code)=>`<pre><code>${code.replace(/</g,'&lt;')}</code></pre>`); s=s.replace(/`([^`]+)`/g,'<code>$1</code>'); s=s.replace(/\*\*([^*]+)\*\*/g,'<b>$1</b>'); s=s.replace(/\*([^*]+)\*/g,'<i>$1</i>'); s=s.replace(/\n/g,'<br>'); markdown.headings=heads; return s; };
    const toPlainText = (md='')=>{ const tmp = document.createElement('div'); tmp.innerHTML = markdown(md||''); return (tmp.textContent||'').replace(/\s+\n/g,'\n'); };
    const ensureXLSX = async ()=>{ if(window.XLSX) return; const s=document.createElement('script'); s.src='https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js'; s.async=true; await new Promise((res,rej)=>{ s.onload=res; s.onerror=rej; document.head.appendChild(s); }); };

    const DemoSets = [
      { id:'set-pan', modality:'Panorama', title:'ÎÇ≠Ï¢Ö vs Ï¢ÖÏñë Í∞êÎ≥Ñ', desc:'Í≤ΩÍ≥Ñ/ÌîºÏßàÌôî/ÏπòÍ∑º Ìù°Ïàò/Îß§Î≥µÏπò Í¥ÄÍ≥ÑÎ°ú Í∞êÎ≥Ñ Ïó∞Ïäµ', tags:['ÎÇ≠Ï¢Ö','Ï¢ÖÏñë','Í∞êÎ≥Ñ'], group:'ÏòÅÏÉÅÍ∞êÎ≥Ñ(Í∏∞Î≥∏)',
        cards:[
          { q:'Ïù¥ ÏòÅÏÉÅÏùò ÏßÑÎã®Î™ÖÏùÄ?', a:'Dentigerous cyst', e:'Îß§Î≥µÏπò ÏπòÍ¥Ä Ï£ºÏúÑÏóê well-defined corticated radiolucency, ÏπòÍ¥Ä Ïó∞Í≤∞.', img:ph('Dentigerous cyst'), tags:['ÎÇ≠Ï¢Ö','Îß§Î≥µÏπò'] },
          { q:'Ïù¥ ÏòÅÏÉÅÏùò ÏßÑÎã®Î™ÖÏùÄ?', a:'Ameloblastoma', e:'Îã§Î∞©ÏÑ±, expansile, thinning/bowing, ÏπòÍ∑º Ìù°Ïàò Í∞ÄÎä•.', img:ph('Ameloblastoma'), tags:['Ï¢ÖÏñë','Îã§Î∞©ÏÑ±'] },
          { q:'Ïù¥ ÏòÅÏÉÅÏùò ÏßÑÎã®Î™ÖÏùÄ?', a:'Radicular cyst', e:'ÎπÑÌôúÏÑ±/Í¥¥ÏÇ¨ ÏπòÏïÑ ÏπòÍ∑ºÎã®Ïùò ÏõêÌòï Î∞©ÏÇ¨ÏÑ†Ìà¨Í≥ºÏÑ± Î≥ëÏÜå, ÏñáÏùÄ ÌîºÏßà Í≤ΩÍ≥Ñ.', img:ph('Radicular cyst'), tags:['ÎÇ≠Ï¢Ö','ÏπòÍ∑ºÎã®'] },
          { q:'Ïù¥ ÏòÅÏÉÅÏùò ÏßÑÎã®Î™ÖÏùÄ?', a:'OKC', e:'Scalloped, Ï†ÑÌõÑ Í∏∏Í≤å, ÏÉÅÎåÄÏ†ÅÏúºÎ°ú ÌåΩÏ∞Ω Ï†ÅÏùå, Ïû¨Î∞ú Í≤ΩÌñ•.', img:ph('OKC'), tags:['ÎÇ≠Ï¢Ö','OKC'] },
          { q:'Îã§Ïùå Ï§ë sunray appearanceÎ•º Î≥¥Ïù¥Îäî ÏïÖÏÑ±ÏùÄ?', a:'Osteosarcoma', e:'Periosteal reaction(sunburst)ÏôÄ Î∂àÍ∑úÏπôÌïú ÌòºÌï©ÏùåÏòÅ.', img:ph('Osteosarcoma'), tags:['ÏïÖÏÑ±','periosteal'] }
        ]
      },
      { id:'set-cbct', modality:'CBCT', title:'CBCT ÌòºÌï©ÏùåÏòÅ Î≥ëÏÜå', desc:'ÌòºÌï©ÏùåÏòÅ¬∑Î∂àÍ∑úÏπô Í≤ΩÍ≥Ñ Î≥ëÏÜå Í∞êÎ≥Ñ Ìè¨Ïù∏Ìä∏', tags:['CBCT','ÌòºÌï©ÏùåÏòÅ'], group:'ÏòÅÏÉÅÍ∞êÎ≥Ñ(Í≥†Í∏â)',
        cards:[
          { q:'Ïù¥ ÏòÅÏÉÅÏùò ÏßÑÎã®Î™ÖÏùÄ?', a:'Cemento-ossifying fibroma', e:'Í≤ΩÍ≥Ñ Î™ÖÌôï¬∑ÌôïÏû•ÏÑ±¬∑ÎÇ¥Î∂Ä ÌòºÌï©ÏùåÏòÅ; ÏÑ±Ïù∏ Ïó¨ÏÑ±, ÌïòÏïÖ Íµ¨ÏπòÎ∂Ä Ìò∏Î∞ú.', img:ph('COF'), tags:['ÌòºÌï©ÏùåÏòÅ','ÏñëÏÑ±'] },
          { q:'Ïù¥ ÏòÅÏÉÅÏùò ÏßÑÎã®Î™ÖÏùÄ?', a:'Chronic osteomyelitis', e:'Î∂àÍ∑úÏπô ÌòºÌï©ÏùåÏòÅ, sequestrum/involucrum, periosteal reaction Í∞ÄÎä•.', img:ph('Osteomyelitis'), tags:['Í∞êÏóº','ÏóºÏ¶ù'] },
          { q:'Ïù¥ ÏòÅÏÉÅÏùò ÏßÑÎã®Î™ÖÏùÄ?', a:'Fibrous dysplasia', e:'Ground-glass, Í≤ΩÍ≥Ñ Î∂àÎ™ÖÌôï, cortical thinning; Ï≤≠ÏÜåÎÖÑ Ìò∏Î∞ú.', img:ph('FD'), tags:['Î∞úÏú°ÏÑ±','ground-glass'] },
          { q:'Ïù¥ ÏòÅÏÉÅÏùò ÏßÑÎã®Î™ÖÏùÄ?', a:'Osteosarcoma', e:'ÌååÍ¥¥Ï†Å Í≤ΩÍ≥Ñ, sunburst, widening of PDL space.', img:ph('OS'), tags:['ÏïÖÏÑ±','sunburst'] }
        ]
      }
    ];
    let BlogPosts = [
      { id:uid(), title:'Î∞©ÏÇ¨ÏÑ†ÌïôÏ†Å ÎÇ≠Ï¢Ö Í∞êÎ≥Ñ: Dentigerous vs Radicular vs OKC', body:`# Í∞úÏöî
ÏπòÏÑ± ÎÇ≠Ï¢ÖÏùÄ ÏòÅÏÉÅÌïôÏ†ÅÏúºÎ°ú **Í≤ΩÍ≥Ñ, ÌîºÏßàÌôî, ÏπòÏïÑÏôÄÏùò Í¥ÄÍ≥Ñ**Î°ú Í∞êÎ≥ÑÌï©ÎãàÎã§.

## Dentigerous cyst
- Îß§Î≥µÏπò *ÏπòÍ¥Ä* Ï£ºÏúÑÏóê **well-defined, corticated** radiolucency
- ÏπòÍ¥ÄÍ≥º Î≥ëÏÜåÏùò **Ïó∞Í≤∞**Ïù¥ ÌïµÏã¨ Îã®ÏÑú

## Radicular cyst
- **ÎπÑÌôúÏÑ±/Í¥¥ÏÇ¨ ÏπòÏïÑ** ÏπòÍ∑ºÎã®Ïóê ÏõêÌòï Ìà¨Í≥ºÏÑ± Î≥ëÏÜå
- ÏñáÏùÄ ÏΩîÎ•¥ÌÖçÏä§, ÏπòÍ∑ºÎã® Î≥ëÎ≥ÄÍ≥ºÏùò Ïó∞ÏÜçÏÑ±

## OKC (Odontogenic keratocyst)
- **Scalloped**, Ï†ÑÌõÑ Í∏∏Í≤å, ÌåΩÏ∞Ω ÏÉÅÎåÄÏ†ÅÏúºÎ°ú Ï†ÅÏùå
- Ïû¨Î∞ú Í≤ΩÌñ•, Îã§Î∞úÏÑ± Ïãú NBCCS Í≥†Î†§`, when: Date.now()-1000*60*60*24*2, category:'ÏòÅÏÉÅÍ∞êÎ≥Ñ' },
      { id:uid(), title:'ÏûÑÌîåÎûÄÌä∏ Ìï©Î≥ëÏ¶ùÏùò ÏòÅÏÉÅÌïôÏ†Å ÏßïÌõÑ', body:`## Peri-implant disease
- **Mucositis**: Ïó∞Ï°∞ÏßÅ ÏóºÏ¶ù Ï§ëÏã¨, *Í≥®ÏÜåÏã§ ÏóÜÏùå*
- **Peri-implantitis**: **crater-like** Í≥®Í≤∞ÏÜê, ÎÇòÏÇ¨ÏÑ† ÎÖ∏Ï∂ú

## ÌèâÍ∞Ä Ìè¨Ïù∏Ìä∏
1. baseline ÎåÄÎπÑ **crestal bone level** Î≥ÄÌôî
2. ÎÇòÏÇ¨ÏÑ† ÎÖ∏Ï∂ú Î≤îÏúÑ
3. Î≥¥Ï≤† Íµ¨Ï°∞Î¨º Ïú†Î¨¥/Ï†ÅÌï©`, when: Date.now()-1000*60*60*20, category:'ÏûÑÌîåÎûÄÌä∏' }
    ];

    let CurrentSet = null;

    const Theme={ toggle(){ document.documentElement.classList.toggle('dark'); const isDark=document.documentElement.classList.contains('dark'); $('#theme-btn').textContent=isDark?'‚òÄÔ∏è':'üåô'; note(isDark?'Îã§ÌÅ¨ Î™®Îìú Ï†ÅÏö©':'ÎùºÏù¥Ìä∏ Î™®Îìú Ï†ÅÏö©'); }, init(){ const saved=localStorage.getItem('theme'); if(saved==='dark'){ document.documentElement.classList.add('dark'); $('#theme-btn').textContent='‚óë'; } else { $('#theme-btn').textContent='‚óê'; } } };

    function routeTo(view, params={}){
      if(!document.getElementById('view-flash').classList.contains('active') && view==='flash'){}
      else if(document.getElementById('view-flash').classList.contains('active') && view!=='flash'){ Flash.stopAutoplay(); }
      $$('section.view').forEach(s=>s.classList.remove('active'));
      $('#view-'+view)?.classList.add('active');
      $$('.tab').forEach(t=>t.classList.toggle('active', t.dataset.nav===view));
      routeTo.params = params;
      if(view==='home')  renderHome();
      if(view==='sets')  renderSetList();
      if(view==='flash') Flash.mount();
      if(view==='quiz')  Quiz.mount();
      if(view==='blog')  Blog.render();
      if(view==='admin') Admin.mount();
      history.replaceState(null, '', '#'+view);
    }
    window.addEventListener('hashchange',()=>{ const v=(location.hash||'#home').slice(1); routeTo(v, routeTo.params||{}); });

    const homeStats=()=>({ sets: DemoSets.length, cards: DemoSets.reduce((n,s)=>n+(s.cards?.length||0),0), blogs: BlogPosts.length });
    function renderHome(){
      const st=homeStats();
      $('#home-stats').innerHTML = [
        `<span class='stat'>ÏÑ∏Ìä∏ <b>${st.sets}</b></span>`,
        `<span class='stat'>Ïπ¥Îìú <b>${st.cards}</b></span>`,
        `<span class='stat'>ÏπºÎüº <b>${st.blogs}</b></span>`
      ].join(' ');
      $('#home-reco').innerHTML = DemoSets.map(s=>tile(s)).join('');
      const latest = [...BlogPosts].sort((a,b)=>b.when-a.when).slice(0,6)
        .map(p=>`<a class='card' href="#blog" data-action="blog-select" data-id="${p.id}" style='padding:12px;'>
          <div style='font-weight:900; font-size:16px;'>${esc(p.title)}</div>
          <div class='muted' style='font-size:12px; margin-bottom:6px;'>${mdDate(p.when)}</div>
          <div class='muted' style='overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;'>
            ${esc((p.body||'').replace(/\n/g, ' ').replace(/#+ /g, '').slice(0,180))}...
          </div>
        </a>`).join('');
      $('#home-blog-list').innerHTML = latest || '<div class="muted">Í∏ÄÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
    }
    function tile(s){
      const tags = (s.tags||[]).slice(0,3).map(t=>`<span class='chip'>#${esc(t)}</span>`).join('');
      const count = (s.cards?.length||0);
      const mod = s.modality||'Mixed';
      return `<div class='set-tile'>
        <div class='thumb'></div>
        <div class='tile-body'>
          <div style='display:flex;align-items:center;gap:8px;justify-content:space-between'>
            <div style='font-weight:900; font-size:16px'>${esc(s.title)}</div>
            <span class='chip'>üÉè ${count}Ïû•</span>
          </div>
          <div class='muted' style="font-size:var(--fs-small)">${esc(s.desc||'')}</div>
          <div class='chips'>
            <span class='chip'>${esc(mod)}</span>
            ${tags}
          </div>
          <div style='display:flex;gap:8px;margin-top:6px'>
            <button class='btn primary' data-action='start-mode' data-mode='flash' data-id='${s.id}'>Flash</button>
            <button class='btn' data-action='start-mode' data-mode='quiz' data-id='${s.id}'>Quiz</button>
          </div>
        </div>
      </div>`;
    }
    function uniqueModalities(){ const set = new Set((DemoSets||[]).map(s=> (s.modality||'').trim()).filter(Boolean)); return Array.from(set).sort(); }
    function ensureModOptions(){ const sel = $('#mod'); if(!sel) return; if(sel.options.length <= 1){ const mods = uniqueModalities(); mods.forEach(m=>{ const opt = document.createElement('option'); opt.value = m; opt.textContent = m; sel.appendChild(opt); }); } }
    function renderSetList(){
      ensureModOptions();
      const q = $('#q')?.value?.trim().toLowerCase()||'';
      const mod=$('#mod')?.value?.trim()||'';
      const list = DemoSets.filter(s=>{
        const bag=[s.title,s.desc,s.modality,(s.tags||[]).join(' '),(s.cards||[]).map(c=>[c.q,c.a,(c.tags||[]).join(' ')].join(' ')).join(' ')].join(' ').toLowerCase();
        const okQ=!q||bag.includes(q);
        const okM=!mod|| norm(s.modality)===norm(mod);
        return okQ&&okM;
      });
      $('#set-list').innerHTML = list.map(tile).join('') || '<div class="card muted">Ï°∞Í±¥Ïóê ÎßûÎäî ÏÑ∏Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§.</div>';
    }

    const Flash={ i:0, flipped:false, order:[], bins:[[],[],[],[],[]], setId:null, countdownId:null, autoNext:true, autoNextDelay:5000, autoplay:false,
      mount(){
        if(!CurrentSet) CurrentSet=DemoSets[0];
        $('#flash-title').textContent=CurrentSet?.title||'';
        if(this.setId!==CurrentSet?.id){ this.reset(); }
        const labels=['1ÌöåÏ∞®','2ÌöåÏ∞®','3ÌöåÏ∞®','4ÌöåÏ∞®','5ÌöåÏ∞®'];
        $('#bins').innerHTML = labels.map((lb)=>`
          <div class="bin">
            <div class="bin-bar"><i style="width:0%"></i></div>
            <div class="muted" style="font-size:12px;margin-top:4px">${lb}</div>
            <div style="font-weight:900;font-size:18px">0</div>
          </div>`).join('');
        $('#auto-next').checked = this.autoNext;
        $('#auto-next-delay').value = String(this.autoNextDelay);
        $('#autoplay-btn').textContent = this.autoplay ? '‚à•' : '‚ñ∏';
        this.render();
        if(!CurrentSet?.cards?.length){ note('Ïù¥ ÏÑ∏Ìä∏ÏóêÎäî Ïπ¥ÎìúÍ∞Ä ÏóÜÏäµÎãàÎã§. AdminÏóêÏÑú Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏ ÎòêÎäî ÏõêÍ≤© ÏÉàÎ°úÍ≥†Ïπ®ÏùÑ Ïã§ÌñâÌïòÏÑ∏Ïöî.', true); }
      },
      reset(){ this.setId=CurrentSet?.id||null; this.order = (CurrentSet?.cards||[]).map((_,i)=>i); this.bins=[[],[],[],[],[]]; this.bins[0]=[...this.order]; this.i=0; this.flipped=false; this.stopTimer(); this.render(); },
      card(){ return CurrentSet?.cards?.[this.order[this.i]]; },
      showFront(){ this.flipped=false; const fc=$('#flash-card'); fc.classList.remove('show-back'); fc.classList.add('show-front'); },
      showBack(){ this.flipped=true; const fc=$('#flash-card'); fc.classList.remove('show-front'); fc.classList.add('show-back'); },
      toggle(){ this.flipped? this.showFront() : this.showBack(); this.stopTimer(); },
      next(){
        const total = this.order.length;
        let attempts = 0;
        do{
          if(this.i<total-1) this.i++; else this.i=0;
          attempts++;
          const idx=this.order[this.i];
          const where=this.binOf(idx);
          if(where < 4) break;
          if(attempts>total) break;
        }while(true);
        this.flipped=false; this.stopTimer(); this.render();
      },
      prev(){ if(this.i>0){ this.i--; this.flipped=false; this.stopTimer(); this.render(); } },
      binOf(idx){ return this.bins.findIndex(b=>b.includes(idx)); },
      moveBin(idx, to){ let from=this.binOf(idx); if(from<0) from=0; this.bins[from]=this.bins[from].filter(x=>x!==idx); this.bins[to].push(idx); },
      grade(ok){
        if(!CurrentSet) return;
        const idx=this.order[this.i];
        let from=this.binOf(idx); if(from<0) from=0;
        const to= ok? Math.min(from+1,4):0;
        this.moveBin(idx, to);
        note(ok? '‚úì ÏïåÏïòÎã§':'√ó Î™∞ÎûêÎã§');
        this.next(); this.renderBins();
        if(this.autoplay && this.allMastered()) this.stopAutoplay(true);
      },
      startTimer(){
        this.stopTimer(); this.showFront();
        let t = +$('#timer-select').value;
        const cd=$('#countdown'); cd.textContent=t; cd.classList.add('show');
        this.countdownId = setInterval(()=>{
          t--; cd.textContent=t;
          if(t<=0){
            clearInterval(this.countdownId); this.countdownId=null;
            cd.classList.remove('show');
            this.showBack(); note('Ï†ïÎãµ Í≥µÍ∞ú!');
            if($('#auto-next').checked){
              const delay = +($('#auto-next-delay').value||this.autoNextDelay);
              setTimeout(()=> {
                if(this.autoplay){
                  this.next();
                  if(this.allMastered()) this.stopAutoplay(true); else this.startTimer();
                } else {
                  this.next();
                }
              }, delay || 5000);
            }
          }
        },1000);
      },
      stopTimer(){ const cd=$('#countdown'); if(cd){ cd.textContent=''; cd.classList.remove('show'); } if(this.countdownId){ clearInterval(this.countdownId); this.countdownId=null; } },
      render(){
        this.stopTimer();
        if(!CurrentSet?.cards?.length){
          $('#flash-img').src=''; $('#flash-answer').textContent=''; $('#flash-explain').textContent='Ïπ¥ÎìúÍ∞Ä ÏóÜÏäµÎãàÎã§.'; $('#flash-pos').textContent='0/0'; $('#flash-bar').style.width='0%';
          $('#flash-card').classList.add('show-front'); return;
        }
        const k=this.card(); if(!k) return;
        $('#flash-img').src=k.img||ph('No image');
        $('#flash-question').textContent = k.q || 'Ïù¥ ÏòÅÏÉÅÏùò ÏßÑÎã®Î™ÖÏùÄ?';
        $('#flash-answer').innerHTML=`<span>${esc(k.a||'')}</span>`;
        $('#flash-explain').innerHTML=`<span>${esc(k.e||'')}</span>`;
        $('#flash-pos').textContent=`${this.i+1}/${this.order.length}`;
        $('#flash-bar').style.width=((this.i+1)/this.order.length*100|0)+'%';
        this.renderBins();
        this.showFront();
      },
      renderBins(){ const binEls = $$('#bins .bin'); const total = CurrentSet?.cards?.length||0; this.bins.forEach((b,i)=>{ const el=binEls[i]; if(!el||!total) return; el.querySelector('.bin-bar i').style.width = `${(b.length/total)*100}%`; el.querySelector('div:last-child').textContent = b.length; }); },
      toggleAutoplay(){
        this.autoplay = !this.autoplay;
        $('#autoplay-btn').textContent = this.autoplay ? '‚ùö‚ùö' : '‚ñ∂Ô∏é';
        if(this.autoplay){
          $('#auto-next').checked = True;
          const firstUnsolved = this.order.findIndex(idx => this.binOf(idx) < 4);
          if(firstUnsolved>=0) this.i = firstUnsolved;
          this.startTimer();
        }else{ this.stopTimer(); }
      },
      stopAutoplay(done=false){ this.autoplay=false; $('#autoplay-btn').textContent = '‚ñ∏'; this.stopTimer(); if(done) note('Î™®Îì† Ïπ¥Îìú 5ÌöåÏ∞® ÏôÑÎ£å! ÏûêÎèô ÏßÑÌñâ Ï¢ÖÎ£å'); },
      allMastered(){ return this.order.every(idx => this.binOf(idx)===4); }
    };

    const Quiz={ sheet:[], i:0, score:0,
      mount(){ if(!CurrentSet) CurrentSet=DemoSets[0]; $('#quiz-title').textContent=(CurrentSet?.title||'')+' ‚Äì Quiz'; $('#quiz-stage').style.display='none'; },
      start(){
        if(!CurrentSet?.cards?.length){ note('Ïù¥ ÏÑ∏Ìä∏Ïóê Ïπ¥ÎìúÍ∞Ä ÏóÜÏñ¥ ÌÄ¥Ï¶àÎ•º ÏãúÏûëÌï† Ïàò ÏóÜÏäµÎãàÎã§.', true); return; }
        const mode=$('#quiz-mode').value; const n=+$('#quiz-n').value;
        const pool=[...(CurrentSet?.cards||[])];
        this.sheet = sample(pool, Math.min(n,pool.length)).map(c=> makeQ(mode,c));
        this.i=0; this.score=0; this.render();
      },
      cur(){ return this.sheet[this.i]; },
      render(){
        const q=this.cur(); const stage=$('#quiz-stage'); stage.style.display='block';
        stage.innerHTML = `
        <div class='muted' style='display:flex;gap:8px;align-items:center;margin-bottom:8px'>
          Î¨∏Ìï≠ <b>${this.i+1}/${this.sheet.length}</b>
          <span style='margin-left:auto'>Ï†êÏàò <b>${this.score}</b></span>
        </div>
        <div style='display:grid;gap:10px'>
          ${q?.image?`<img src='${q.image}' alt='x-ray' style="max-height:360px; object-fit:contain"/>`:''}
          <div style='font-weight:900; font-size:var(--fs-h2)'>
            <span>${esc(q?.stem||'')}</span>
            <button class="btn icon" data-action="tts-toggle" aria-label="ÏùΩÍ∏∞/ÏùºÏãúÏ†ïÏßÄ" data-text="${esc(q?.stem||'')}">üîä</button>
            <button class="btn icon" data-action="tts-stop" aria-label="Ï†ïÏßÄ">‚ñ†</button>
          </div>
          <div id='quiz-opts' class='grid' style="gap:8px"></div>
          <div id='quiz-exp' class='muted' style='display:none'></div>
          <div style='display:flex;gap:8px'>
            <button class='btn' data-action='quiz-prev'>Ïù¥Ï†Ñ</button>
            <button class='btn primary' data-action='quiz-next'>Îã§Ïùå</button>
          </div>
        </div>`;
        const wrap=$('#quiz-opts');
        if(!q) return;
        if(q.kind==='mc'||q.kind==='tf'){
          q.options.forEach((opt,idx)=>{ const el=document.createElement('div'); el.className='opt'; el.textContent=opt; el.dataset.action='quiz-pick'; el.dataset.idx=idx; wrap.appendChild(el); });
        } else {
          const input=document.createElement('input'); input.placeholder='Ï†ïÎãµ ÏûÖÎ†•'; input.style.cssText='padding:12px;border-radius:12px;border:1px solid var(--line);background:#fff;color:#0f172a';
          const btn=document.createElement('button'); btn.className='btn'; btn.textContent='ÌôïÏù∏'; btn.dataset.action='quiz-fill';
          wrap.appendChild(input); wrap.appendChild(btn);
        }
      },
      pick(idx){ const q=this.cur(); const nodes=$$('#quiz-opts .opt'); nodes.forEach((n,i)=>{n.dataset.action=''; n.classList.toggle('correct', i===q.answerIndex); if(i===idx && i!==q.answerIndex) n.classList.add('wrong');}); if(idx===q.answerIndex){this.score++; note('Ï†ïÎãµ!');} else {note('Ïò§Îãµ');} this.explain(); },
      fillCheck(val){ const q=this.cur(); const ok = norm(val)===norm(q.answerText); if(ok){this.score++; note('Ï†ïÎãµ!');} else {note('Ïò§Îãµ');} this.explain(ok?undefined:`Ï†ïÎãµ: ${q.answerText}`); },
      explain(extra){ const q=this.cur(); const exp=$('#quiz-exp'); exp.style.display='block'; exp.textContent = (extra? extra+ ' ¬∑ ' : '') + (q.explain||''); },
      next(){ if(this.i<this.sheet.length-1){ this.i++; this.render(); } else this.finish(); },
      prev(){ if(this.i>0){ this.i--; this.render(); } },
      finish(){ const acc=((this.score/this.sheet.length)*100|0); $('#quiz-stage').innerHTML = `<div style='font-size:22px;font-weight:900;margin-bottom:6px'>ÌÄ¥Ï¶à ÏôÑÎ£å!</div><div class='muted'>ÏµúÏ¢Ö Ï†êÏàò</div><div style='font-size:46px;font-weight:900;margin:6px 0 14px'>${this.score}/${this.sheet.length} (${acc}%)</div><div style='display:flex;gap:8px'><button class='btn primary' data-action='quiz-restart'>Îã§Ïãú ÌíÄÍ∏∞</button><button class='btn' data-action='start-mode' data-mode='flash'>Flash Î≥µÏäµ</button></div>`; }
    };
    function makeQ(mode, k){
      if(mode==='tf'){ const truth = Math.random()<0.5; const others = DemoSets.flatMap(s=>s.cards).filter(x=>x!==k); const alt = others.length? sample(others,1)[0] : k; const text = truth ? k.a : alt.a; const stem = 'Ïù¥ ÏòÅÏÉÅÏùò ÏßÑÎã®Î™ÖÏùÄ ' + esc(text) + ' Ïù¥Îã§.'; return {kind:'tf', stem, image:k.img, explain:k.e, options:['O','X'], answerIndex: truth?0:1}; }
      if(mode==='fill'){ return {kind:'fill', stem:'ÏïÑÎûò ÏòÅÏÉÅÏùò ÏßÑÎã®Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.', image:k.img, explain:k.e, answerText:k.a}; }
      const others = DemoSets.flatMap(s=>s.cards).filter(x=>x!==k); const picks = sample(others, Math.min(3, others.length)).map(o=>o.a); const opts = [...picks, k.a]; shuffle(opts); return {kind:'mc', stem:'ÏïÑÎûò ÏòÅÏÉÅÏùò ÏßÑÎã®Î™ÖÏùÄ?', image:k.img, explain:k.e, options:opts, answerIndex:opts.indexOf(k.a)};
    }

    const Blog={ curId:null, listOpen:true,
      new(){ this.curId=null; this.showEditor(True); $('#blog-title').value=''; $('#blog-body').value=''; $('#blog-view').innerHTML='<div class="muted">ÏÉà Í∏Ä ÏûëÏÑ± Ï§ë...</div>'; $('#blog-toc').style.display='none'; },
      select(id){ this.curId=id; const p=BlogPosts.find(x=>x.id===id); if(!p) return; this.showEditor(false); this.renderView(p); this.renderTOC(); $$('#blog-list a').forEach(el => el.classList.toggle('active', el.dataset.id === id)); },
      renderView(p){ const html = `<h1>${esc(p.title)}</h1><div class="muted" style="margin-bottom:12px">${mdDate(p.when)}${p.category? ' ¬∑ '+esc(p.category):''}</div>`+ markdown(p.body||''); $('#blog-view').innerHTML=html; },
      renderTOC(){ const toc = markdown.headings||[]; const el=$('#blog-toc'); if(!toc.length || !this.listOpen){ el.style.display='none'; el.innerHTML=''; return; } let h='<div style="font-weight:900;margin:10px 0 6px">Î™©Ï∞®</div><ul>'; let prev = 1; toc.forEach(({id, level, text})=>{ if(level>prev) h+='<ul>'; else if(level<prev) h+='</ul>'.repeat(prev-level); h+=`<li><a href="javascript:void(0)" data-action="toc-goto" data-target="${id}">${esc(text)}</a></li>`; prev=level; }); h+='</ul>'.repeat(prev)+'</ul>'; el.innerHTML=h; el.style.display='block'; },
      editStart(){ if(!this.checkKey()) return; const p=BlogPosts.find(x=>x.id===this.curId); if(!p){ note('ÏÑ†ÌÉùÎêú Í∏Ä ÏóÜÏùå'); return; } this.showEditor(true); $('#blog-title').value=p.title; $('#blog-body').value=p.body; },
      save(){ if(!this.checkKey()) return; const t=$('#blog-title').value.trim(); const b=$('#blog-body').value.trim(); if(!t||!b){ note('Ï†úÎ™©/ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•'); return; } if(this.curId){ const p=BlogPosts.find(x=>x.id===this.curId); if(p){ p.title=t; p.body=b; p.when=Date.now(); this.renderView(p); } } else { const np={id:uid(), title:t, body:b, when:Date.now()}; BlogPosts.unshift(np); this.curId=np.id; this.render(); } persist(); note('Ï†ÄÏû•Îê®'); this.showEditor(false); renderHome(); },
      cancel(){ this.showEditor(false); const p=BlogPosts.find(x=>x.id===this.curId); if(p) this.renderView(p); },
      delete(){ if(!this.checkKey()) return; if(!this.curId){ note('ÏÑ†ÌÉùÎêú Í∏Ä ÏóÜÏùå'); return; } if(!confirm('Ï†ïÎßê ÏÇ≠Ï†úÌï†ÍπåÏöî?')) return; BlogPosts = BlogPosts.filter(x=>x.id!==this.curId); this.curId = BlogPosts[0]?.id||null; persist(); this.render(); note('ÏÇ≠Ï†úÎê®'); renderHome(); },
      showEditor(show){ $('#blog-editor').style.display= show? 'block':'none'; },
      render(){
        const q = ($('#blog-q')?.value||'').toLowerCase();
        const list = BlogPosts.filter(p=>!q|| p.title.toLowerCase().includes(q)||p.body.toLowerCase().includes(q));
        $('#blog-list').innerHTML = this.listOpen ? (list.map(p=>`<li><a data-action='blog-select' data-id='${p.id}'>${esc(p.title)}</a></li>`).join('') || '<div class="muted" style="padding:8px">Í∏ÄÏù¥ ÏóÜÏäµÎãàÎã§.</div>') : '';
        if(this.listOpen) this.renderTOC(); else { $('#blog-toc').style.display='none'; $('#blog-toc').innerHTML=''; }
        if(this.curId){ const p = BlogPosts.find(x=>x.id===this.curId); if(p) this.select(this.curId);
        } else if (list.length > 0) { this.select(list[0].id);
        } else { $('#blog-view').innerHTML = ''; $('#blog-toc').style.display = 'none'; }
        renderHome();
      },
      speakBody(){ const p=BlogPosts.find(x=>x.id===this.curId); if(!p) return; const text = toPlainText(p.body||''); if(!text.trim()) { note('ÏùΩÏùÑ Î≥∏Î¨∏Ïù¥ ÏóÜÏäµÎãàÎã§.'); return; } tts.toggle(text); },
      stopSpeak(){ tts.stop(); },
      toggleList(){ this.listOpen = !this.listOpen; this.render(); },
      checkKey(){ const k=$('#blog-key').value.trim(); if(k!==ADMIN_KEY){ note('Í¥ÄÎ¶¨Ïûê ÌÇ§ Ïò§Î•ò',true); return False } return True; }
    };

    const Admin={ mount(){ fillTargetSets(); $('#adm-key').value=''; },
      checkKey(){ const k=$('#adm-key').value.trim(); if(k!==ADMIN_KEY){ note('Í¥ÄÎ¶¨Ïûê ÌÇ§ Ïò§Î•ò',true); return False } return True; },
      uploadJSON(){ if(!this.checkKey())return; try{ const arr=JSON.parse($('#adm-json').value||'[]'); addCards(arr, targetSetId()); note('Îì±Î°ù ÏôÑÎ£å'); routeTo('sets'); }catch(e){ note('JSON Ïò§Î•ò: '+e.message,true) } },
      uploadFile: async ()=>{ if(!Admin.checkKey()) return;
        const f=$('#adm-file').files?.[0]; if(!f){ note('ÌååÏùº ÏÑ†ÌÉù'); return; }
        const ext = (f.name.split('.').pop()||'').toLowerCase();
        const buf = await f.arrayBuffer();
        let rows=[];
        try{
          if(ext==='csv'){ const text = new TextDecoder('utf-8').decode(buf); rows = parseCSV(text);
          } else if(ext==='xlsx'){ await ensureXLSX(); const wb = XLSX.read(buf, {type:'array'}); const ws = wb.Sheets[wb.SheetNames[0]]; rows = XLSX.utils.sheet_to_json(ws, {defval:''});
          } else if(ext==='json'){ rows = JSON.parse(new TextDecoder('utf-8').decode(buf));
          } else { note('ÏßÄÏõêÌïòÏßÄ ÏïäÎäî ÌòïÏãù', true); return; }
        }catch(e){ note('ÌååÏã± Ïã§Ìå®: '+e.message, true); return; }
        if(Array.isArray(rows) && rows.length && !rows[0].q && rows[0].cards){ replaceSets(rows);
        }else{ addCards(rows, targetSetId()); }
        note('Îì±Î°ù ÏôÑÎ£å'); routeTo('sets');
      },
      exportAll(){ const data = { sets: DemoSets, blogs: BlogPosts }; const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='dentblog-backup.json'; a.click(); },
      resetConfirm(){ if(!this.checkKey())return; if(confirm('Ï†ïÎßê Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º Ï¥àÍ∏∞ÌôîÌï†ÍπåÏöî?')){ localStorage.clear(); location.reload(); } }
    };
    function targetSetId(){ const sel=$('#adm-target').value; const name=($('#adm-newset').value||'').trim(); if(sel==='__new__' && name){ let s={id:slug(name), modality:'Mixed', title:name, desc:'Í¥ÄÎ¶¨Ïûê ÏÉùÏÑ± ÏÑ∏Ìä∏', tags:['custom'], cards:[]}; DemoSets.push(s); fillTargetSets(); return s.id; } return sel; }
    function fillTargetSets(){ const el=$('#adm-target'); if(!el) return; const opts = (DemoSets||[]).map(s=>`<option value='${s.id}'>${esc(s.title)} (${s.cards?.length||0})</option>`).join('') + `<option value='__new__'>+ ÏÉà ÏÑ∏Ìä∏‚Ä¶</option>`; el.innerHTML=opts; }
    function addCards(arr,setId){
      const s = DemoSets.find(x=>x.id===setId)||DemoSets[0]; if(!s) return;
      (arr||[]).forEach(row=>{
        const q = row.q || row.question || '';
        const a = row.a || row.answer || '';
        const e = row.e || row.explain || row.explanation || '';
        const img = row.img || '';
        const tags = parseTags(row.tags);
        const modality = row.modality || s.modality || 'Mixed';
        const setDesc = row.set_desc || s.desc || '';
        const group = row.group || s.group || '';
        s.modality = modality; s.desc = setDesc; s.group = group;
        s.cards.push({ q, a, e, img: img||ph(a||'Card'), tags });
      });
      persist(); renderSetList(); renderHome();
    }
    function replaceSets(newSets){ if(!Array.isArray(newSets)) return; DemoSets.length = 0; newSets.forEach(s=> DemoSets.push(s)); persist(); renderSetList(); renderHome(); }

    const KEY='dentblog_state_v1';
    const persist=()=>{ try{ localStorage.setItem(KEY, JSON.stringify({sets:DemoSets, blogs:BlogPosts})); }catch(e){ } };
    function restoreLocal(){
      const raw=localStorage.getItem(KEY);
      if(!raw) return false;
      try{ const st=JSON.parse(raw); if(st.sets) replaceSets(st.sets); if(st.blogs) BlogPosts=st.blogs; return true; }catch(e){ return false; }
    }

    const fetchText = async (url)=> (await fetch(url, {cache:'no-store'})).text();
    const fetchJSON = async (url)=> (await fetch(url, {cache:'no-store'})).json();
    const fetchBuf  = async (url)=> (await fetch(url, {cache:'no-store'})).arrayBuffer();

    async function tryLoadSets(){
      for(const p of RemotePaths.sets){
        const url = baseUrl + p;
        try{
          if(p.endsWith('.json')){ const js = await fetchJSON(url); if(Array.isArray(js)){ replaceSets(js); return 'sets.json'; } else if(js?.sets){ replaceSets(js.sets); return 'sets.json(wrapper)'; }
          } else if(p.endsWith('.csv')){ const txt = await fetchText(url); const rows = parseCSV(txt); csvRowsToSets(rows); return 'sets.csv';
          } else if(p.endsWith('.xlsx')){ await ensureXLSX(); const buf=await fetchBuf(url); const wb=XLSX.read(buf,{type:'array'}); const ws=wb.Sheets[wb.SheetNames[0]]; const rows=XLSX.utils.sheet_to_json(ws,{defval:''}); csvRowsToSets(rows); return 'sets.xlsx'; }
        }catch(e){ }
      }
      return null;
    }
    function csvRowsToSets(rows){
      const map=new Map();
      (rows||[]).forEach(r=>{
        const setId = slug(r.set || 'unnamed');
        if(!map.has(setId)){
          map.set(setId, { id:setId, modality:r.modality||'Mixed', title:r.set||'unnamed', desc:r.set_desc||'', tags:[], group:r.group||'', cards:[] });
        }
        map.get(setId).cards.push({ q:r.q||'', a:r.a||'', e:r.e||'', img:r.img||'', tags:parseTags(r.tags) });
      });
      replaceSets(Array.from(map.values()));
    }

    async function tryLoadBlogs(){
      for(const p of RemotePaths.blogs){
        const url = baseUrl + p;
        try{
          if(p.endsWith('.json')){ const js = await fetchJSON(url); if(Array.isArray(js)){ BlogPosts=js; return 'blogs.json'; } else if(js?.blogs){ BlogPosts=js.blogs; return 'blogs.json(wrapper)'; }
          } else if(p.endsWith('.csv')){ const txt = await fetchText(url); const rows = parseCSV(txt); BlogPosts = rows.map(r=>({ id:uid(), title:r.title||'', body:r.body||'', when: Date.now(), category:r.category||'' })); return 'blogs.csv';
          } else if(p.endsWith('.xlsx')){ await ensureXLSX(); const buf=await fetchBuf(url); const wb=XLSX.read(buf,{type:'array'}); const ws=wb.Sheets[wb.SheetNames[0]]; const rows=XLSX.utils.sheet_to_json(ws,{defval:''}); BlogPosts = rows.map(r=>({ id:uid(), title:r.title||'', body:r.body||'', when: Date.now(), category:r.category||'' })); return 'blogs.xlsx'; }
        }catch(e){ }
      }
      return null;
    }

    async function remoteReload(){
      busy(true,'ÏõêÍ≤© Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏ Ï§ë...');
      let log='';
      const s = await tryLoadSets(); log += 'sets: ' + (s||'ÎØ∏Î∞úÍ≤¨') + '\n';
      const b = await tryLoadBlogs(); log += 'blogs: ' + (b||'ÎØ∏Î∞úÍ≤¨') + '\n';
      $('#dev-log').textContent = log;
      busy(false, s||b? 'ÏõêÍ≤© Îç∞Ïù¥ÌÑ∞ Ï†ÅÏö© ÏôÑÎ£å':'ÏõêÍ≤© Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§');
      renderHome(); renderSetList(); Blog.render();
    }

    document.addEventListener('click', (e)=>{
      const navEl = e.target.closest('[data-nav]');
      if(navEl){ e.preventDefault(); routeTo(navEl.dataset.nav, routeTo.params||{}); return; }

      const a = e.target.closest('[data-action]'); if(!a) return;
      const act = a.dataset.action;

      if(act==='toggle-theme'){ Theme.toggle(); }

      if(act==='start-mode'){ const id = a.dataset.id || CurrentSet?.id || DemoSets[0]?.id; CurrentSet = DemoSets.find(s=>s.id===id) || DemoSets[0]; if(a.dataset.mode==='flash') routeTo('flash'); else if(a.dataset.mode==='quiz') routeTo('quiz'); }

      if(act==='flash-prev'){ Flash.prev(); }
      if(act==='flash-next'){ Flash.next(); }
      if(act==='flash-grade'){ Flash.grade(+a.dataset.ok===1); }
      if(act==='start-timer'){ Flash.startTimer(); }
      if(act==='flash-toggle'){ Flash.toggle(); }
      if(act==='flash-autoplay'){ Flash.toggleAutoplay(); }

      if(act==='quiz-start'){ Quiz.start(); }
      if(act==='quiz-next'){ Quiz.next(); }
      if(act==='quiz-prev'){ Quiz.prev(); }
      if(act==='quiz-restart'){ Quiz.start(); }
      if(act==='quiz-pick'){ Quiz.pick(+a.dataset.idx); }
      if(act==='quiz-fill'){ const v=$('#quiz-opts input')?.value||''; Quiz.fillCheck(v); }
      if(act==='tts-toggle'){ tts.toggle(a.dataset.text||''); }
      if(act==='tts-stop'){ tts.stop(); }

      if(act==='blog-new'){ Blog.new(); }
      if(act==='blog-select'){ routeTo('blog'); Blog.select(a.dataset.id); }
      if(act==='blog-edit'){ Blog.editStart(); }
      if(act==='blog-save'){ Blog.save(); }
      if(act==='blog-cancel'){ Blog.cancel(); }
      if(act==='blog-delete'){ Blog.delete(); }
      if(act==='blog-list-toggle'){ Blog.toggleList(); }
      if(act==='toc-goto'){ const id = a.dataset.target; const h = document.getElementById(id); if(h){ h.scrollIntoView({behavior:'smooth', block:'start'}); } }

      if(act==='adm-json'){ Admin.uploadJSON(); }
      if(act==='adm-file'){ Admin.uploadFile(); }
      if(act==='adm-export'){ Admin.exportAll(); }
      if(act==='adm-reset'){ Admin.resetConfirm(); }
      if(act==='remote-reload'){ remoteReload(); }
    });

    document.addEventListener('keydown', (e)=>{
      if(!$('#view-flash').classList.contains('active')) return;
      if(e.code==='Space'){ e.preventDefault(); Flash.toggle(); }
      if(e.code==='ArrowRight'){ Flash.next(); }
      if(e.code==='ArrowLeft'){ Flash.prev(); }
    });

    $('#auto-next')?.addEventListener('change', ()=>{ Flash.autoNext = $('#auto-next').checked; });
    $('#auto-next-delay')?.addEventListener('change', ()=>{ Flash.autoNextDelay = +$('#auto-next-delay').value || 5000; });
    $('#q')?.addEventListener('input', renderSetList);
    $('#mod')?.addEventListener('change', renderSetList);

    (async function init(){
      Theme.init();
      restoreLocal();
      renderHome(); renderSetList(); Blog.render();
      const view = (location.hash||'#home').slice(1);
      if(['home','sets','flash','quiz','blog','admin'].includes(view)) routeTo(view); else routeTo('home');
    })();
  </script>
</body>
</html>
"""
